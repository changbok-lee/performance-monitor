<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>아임웹 고객사 FO 속도 성능 모니터링 대시보드</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="js/auth.js"></script>
  <script>
    // 인증 체크
    (async function() {
      const isValid = await Auth.requireAuth();
      if (!isValid) return;
    })();
  </script>
  <style>
    /* 메인 탭 네비게이션 */
    .main-tabs {
      display: flex;
      gap: 0;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 5px;
      margin-right: auto;
    }

    .main-tab-btn {
      padding: 12px 24px;
      border: none;
      background: transparent;
      color: rgba(255,255,255,0.8);
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .main-tab-btn:hover {
      background: rgba(255,255,255,0.15);
      color: white;
    }

    .main-tab-btn.active {
      background: rgba(255,255,255,0.25);
      color: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* 탭 컨텐츠 */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* 헤더 액션 버튼들 */
    .header-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    /* 대시보드 탭의 측정 버튼 숨김 (측정결과 탭에서만 표시) */
    .measure-buttons {
      display: none;
      gap: 10px;
      flex-wrap: wrap;
    }

    .measure-buttons.visible {
      display: flex;
    }
  </style>
</head>
<body>

  <!-- 로딩 표시 -->
  <div id="loading" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; justify-content: center; align-items: center;">
    <div style="text-align: center;">
      <div class="spinner" style="
        width: 60px;
        height: 60px;
        border: 6px solid #f3f3f3;
        border-top: 6px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      "></div>
      <div style="font-size: 18px; color: #666; font-weight: 500;">
        데이터 로딩 중...
      </div>
    </div>
  </div>

  <div class="container">
    <header>
    <div class="header-content">
        <h1>📊 아임웹 고객사 FO 속도 성능 모니터링</h1>
        <nav>
          <!-- 메인 탭 네비게이션 -->
          <div class="main-tabs">
            <button class="main-tab-btn active" onclick="switchMainTab('dashboard')">
              📊 대시보드
            </button>
            <button class="main-tab-btn" onclick="switchMainTab('results')">
              📋 측정결과
            </button>
            <button class="main-tab-btn" onclick="switchMainTab('urlmanager')">
              ⚙️ URL 관리
            </button>
          </div>

          <!-- 헤더 액션 버튼들 -->
          <div class="header-actions">
            <!-- 측정 버튼 (측정결과 탭에서만 표시) -->
            <div id="measureButtons" class="measure-buttons">
              <button onclick="startMeasurement('all')" class="btn btn-measure btn-all">
                  🚀 전체 측정
              </button>
              <button onclick="startMeasurement('Mobile')" class="btn btn-measure btn-mobile">
                  📱 Mobile
              </button>
              <button onclick="startMeasurement('Desktop')" class="btn btn-measure btn-desktop">
                  💻 Desktop
              </button>
            </div>

            <button id="loginHistoryBtn" onclick="showLoginHistory()" class="btn btn-measure" style="display: none; background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3);">
                📋 접속기록
            </button>
            <button onclick="Auth.logout()" class="btn btn-measure" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3);">
                🚪 로그아웃
            </button>
          </div>
        </nav>
    </div>
    </header>

    <main>
      <!-- ==================== 대시보드 탭 ==================== -->
      <div id="tab-dashboard" class="tab-content active">
        <!-- 통합 요약 섹션 -->
        <section class="unified-summary">
          <!-- 상단 요약 (왼쪽: 통계, 오른쪽: 데일리 상태별 분포) -->
          <div class="summary-top-row">
            <!-- 왼쪽: 통계 카드 (2x2 그리드) -->
            <div class="summary-stats-grid">
              <div class="stat-item">
                <span class="stat-label">📊 Performance 평균점수 <span class="stat-info-icon" title="전체 측정 데이터의 Lighthouse Performance 점수 평균값입니다.">ⓘ</span></span>
                <span class="stat-value" id="avgPerformance">-</span>
                <span class="stat-unit">점</span>
              </div>
              <div class="stat-item stat-item-button" onclick="switchMainTab('results')">
                <span class="stat-label">🔗 측정된 URL <span class="stat-info-icon" title="활성화된 URL 개수입니다. 클릭하면 URL 목록을 확인할 수 있습니다.">ⓘ</span></span>
                <span class="stat-value" id="totalUrls">-</span>
                <span class="stat-unit">개</span>
                <span class="stat-link">더보기 →</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">📈 총 측정 횟수 <span class="stat-info-icon" title="지금까지 수행된 전체 성능 측정 횟수입니다.">ⓘ</span></span>
                <span class="stat-value" id="totalMeasurements">-</span>
                <span class="stat-unit">회</span>
              </div>
              <div class="stat-item stat-item-button" onclick="showImprovementReportModal()">
                <span class="stat-label">📋 개선사항 Report <span class="stat-info-icon" title="최근 측정에서 발견된 성능 문제점과 AI 기반 개선 제안을 확인할 수 있습니다.">ⓘ</span></span>
                <span class="stat-link">더보기 →</span>
              </div>
            </div>

            <!-- 오른쪽: 데일리 상태별 분포 -->
            <div class="daily-status-section">
              <h3>📊 데일리 상태별 분포 <span class="daily-status-date" id="dailyStatusDate"></span></h3>
              <div class="daily-status-bars">
                <div class="daily-status-item">
                  <span class="daily-status-label good">Good</span>
                  <span class="daily-status-value" id="dailyGoodCount">0개 (0%)</span>
                </div>
                <div class="daily-status-item">
                  <span class="daily-status-label warning">Needs Improvement</span>
                  <span class="daily-status-value" id="dailyWarningCount">0개 (0%)</span>
                </div>
                <div class="daily-status-item">
                  <span class="daily-status-label poor">Poor</span>
                  <span class="daily-status-value" id="dailyPoorCount">0개 (0%)</span>
                </div>
                <div class="daily-status-item">
                  <span class="daily-status-label failed">실패</span>
                  <span class="daily-status-value" id="dailyFailedCount">0개 (0%)</span>
                </div>
              </div>
            </div>
          </div>

          <!-- 하단 통합 정보 -->
          <div class="summary-bottom">

          <!-- 네트워크별 비교 -->
          <div class="network-section">
          <h3>📱 Mobile vs 📱 Mobile (5G) vs 💻 Desktop</h3>
          <p class="network-info">Mobile: Slow 4G (400Kbps) | Mobile 5G: 5G (10Mbps) | Desktop: Cable (100Mbps) | <a href="#" onclick="show5GExplanationModal(); return false;" style="color: #667eea; text-decoration: underline; cursor: pointer;">5G 예상값 계산 방법</a></p>
          <div class="network-comparison-mini">
              <!-- 만족 기준 (Good) -->
              <div class="network-card-mini target-card">
              <h4>Good 기준</h4>
              <div class="network-metrics">
                  <div class="network-metric">
                  <span class="metric-label-with-tooltip">Performance <span class="metric-info-icon" title="Lighthouse 종합 성능 점수 (0~100). 90점 이상이면 'Good'으로 분류됩니다.">ⓘ</span></span>
                  <strong class="target-value">90+</strong>
                  </div>
                  <div class="network-metric">
                  <span class="metric-label-with-tooltip">FCP <span class="metric-info-icon" title="First Contentful Paint: 첫 번째 콘텐츠(텍스트, 이미지 등)가 화면에 표시되는 시간. 1.8초 이하가 Good입니다.">ⓘ</span></span>
                  <strong class="target-value">1.8s</strong>
                  </div>
                  <div class="network-metric">
                  <span class="metric-label-with-tooltip">LCP <span class="metric-info-icon" title="Largest Contentful Paint: 뷰포트에서 가장 큰 콘텐츠 요소가 렌더링되는 시간. 2.5초 이하가 Good입니다.">ⓘ</span></span>
                  <strong class="target-value">2.5s</strong>
                  </div>
                  <div class="network-metric">
                  <span class="metric-label-with-tooltip">TBT <span class="metric-info-icon" title="Total Blocking Time: FCP와 TTI 사이에 메인 스레드가 차단된 총 시간. 200ms 이하가 Good입니다.">ⓘ</span></span>
                  <strong class="target-value">200ms</strong>
                  </div>
              </div>
              </div>

              <div class="network-card-mini">
              <h4>📱 Mobile (4G)</h4>
              <div class="network-metrics">
                  <div class="network-metric">
                  <span>Performance</span>
                  <strong id="mobilePerf">-</strong>
                  </div>
                  <div class="network-metric">
                  <span>FCP</span>
                  <strong id="mobileFcp">-</strong>
                  </div>
                  <div class="network-metric">
                  <span>LCP</span>
                  <strong id="mobileLcp">-</strong>
                  </div>
                  <div class="network-metric">
                  <span>TBT</span>
                  <strong id="mobileTbt">-</strong>
                  </div>
              </div>
              </div>

              <div class="network-card-mini">
              <h4>📱 Mobile (5G)</h4>
              <div class="network-metrics">
                  <div class="network-metric">
                  <span>Performance</span>
                  <strong id="mobile5gPerf">-</strong>
                  </div>
                  <div class="network-metric">
                  <span>FCP</span>
                  <strong id="mobile5gFcp">-</strong>
                  </div>
                  <div class="network-metric">
                  <span>LCP</span>
                  <strong id="mobile5gLcp">-</strong>
                  </div>
                  <div class="network-metric">
                  <span>TBT</span>
                  <strong id="mobile5gTbt">-</strong>
                  </div>
              </div>
              </div>

              <div class="network-card-mini">
              <h4>💻 Desktop</h4>
              <div class="network-metrics">
                  <div class="network-metric">
                  <span>Performance</span>
                  <strong id="desktopPerf">-</strong>
                  </div>
                  <div class="network-metric">
                  <span>FCP</span>
                  <strong id="desktopFcp">-</strong>
                  </div>
                  <div class="network-metric">
                  <span>LCP</span>
                  <strong id="desktopLcp">-</strong>
                  </div>
                  <div class="network-metric">
                  <span>TBT</span>
                  <strong id="desktopTbt">-</strong>
                  </div>
              </div>
              </div>
          </div>
          </div>
        </section>

        <!-- 성능 추이 차트 (180일, Mobile/Desktop 분리) -->
        <section class="chart-section">
          <h2>📈 Performance 평균 추이 (최근 180일) <span class="section-info-icon" title="최근 180일간 일별 Performance 점수 평균을 Mobile/Desktop별로 보여줍니다.">ⓘ</span></h2>
          <canvas id="performanceChart"></canvas>
        </section>

        <!-- 페이지상세별 성능 평균 비교 -->
        <section class="page-comparison-section">
          <h2>📊 페이지상세별 성능 평균 비교 <span class="section-info-icon" title="가장 최근 측정일(1일) 기준으로 페이지 유형별(홈/상품목록/상품상세) 성능을 비교합니다. 각 사이트별 우수/개선필요 순위도 확인할 수 있습니다.">ⓘ</span></h2>
          <div id="pageComparisonContainer">
            <!-- 동적으로 카드들이 추가됨 -->
            <div class="loading-placeholder">데이터를 불러오는 중...</div>
          </div>
        </section>
      </div>

      <!-- ==================== 측정결과 탭 ==================== -->
      <div id="tab-results" class="tab-content">
        <section class="data-table-section" id="resultsSection">
          <div class="section-header">
            <h2>📋 측정 결과 (URL별 평균)</h2>
            <div class="button-group">
              <button id="btnRefresh" onclick="loadDashboard()" class="btn btn-secondary" style="display: none;">
                🔄 새로고침
              </button>
              <button id="btnDownloadCSV" onclick="downloadCSV()" class="btn btn-success" style="display: none;">
                📥 CSV 다운로드
              </button>
              <button id="btnClearAll" onclick="clearAllMeasurements()" class="btn btn-danger" style="display: none;">
                🗑️ 결과 초기화
              </button>
              <button onclick="show5GExplanationModal()" class="btn btn-info">
                📱 5G 예상값 계산 방법
              </button>
            </div>
          </div>

          <!-- 네트워크 탭 -->
          <div class="network-tabs">
            <button class="tab-btn active" onclick="switchNetworkTab('Mobile')">
              📱 Mobile (Slow 4G)
            </button>
            <button class="tab-btn" onclick="switchNetworkTab('Mobile5G')">
              📱 Mobile (5G 예상값)
            </button>
            <button class="tab-btn" onclick="switchNetworkTab('Desktop')">
              💻 Desktop (Cable 100Mbps)
            </button>
          </div>

          <div class="filters-enhanced">
            <div class="filter-row">
              <div class="filter-item">
                <label>사이트명</label>
                <select id="siteNameFilter">
                  <option value="">전체</option>
                </select>
              </div>

              <div class="filter-item">
                <label>페이지상세</label>
                <select id="pageDetailFilter">
                  <option value="">전체</option>
                </select>
              </div>

              <div class="filter-item">
                <label>상태</label>
                  <select id="statusFilter">
                  <option value="">전체</option>
                  <option value="Good">✅ 우수</option>
                  <option value="Needs Improvement">⚠️ 보통</option>
                  <option value="Poor">❌ 개선 필요</option>
                  </select>
              </div>
            </div>

            <div class="filter-row">
              <div class="filter-item filter-search">
                <label>URL 검색</label>
                <input
                  type="text"
                  id="tableSearch"
                  placeholder="URL 검색..."
                >
              </div>

              <div class="filter-actions">
                <button onclick="applyFilters()" class="btn btn-primary">
                  🔍 조회
                </button>
                <button onclick="resetFilters()" class="btn btn-secondary">
                  🔄 초기화
                </button>
              </div>
            </div>
          </div>

          <div class="table-container">
            <table id="resultsTable">
              <thead>
                <tr>
                  <th style="width: 120px;">최근측정일시</th>
                  <th style="width: 180px;">URL</th>
                  <th style="width: 100px;">사이트명</th>
                  <th style="width: 100px;">페이지상세</th>
                  <th style="width: 90px;">
                    <span class="tooltip-header">
                      Performance
                      <span class="tooltip-text">
                        <strong>Performance Score</strong>
                        Google Lighthouse 성능 점수 (0-100점). 페이지 로딩 속도와 사용자 경험을 종합 평가합니다.
                      </span>
                    </span>
                  </th>
                  <th style="width: 80px;">
                    <span class="tooltip-header">
                      상태
                      <span class="tooltip-text">
                        <strong>Performance Status</strong>
                        Good (90-100점): 우수<br>
                        Needs Improvement (50-89점): 개선 필요<br>
                        Poor (0-49점): 나쁨
                      </span>
                    </span>
                  </th>
                  <th style="width: 70px;">
                    <span class="tooltip-header">
                      FCP
                      <span class="tooltip-text">
                        <strong>First Contentful Paint</strong>
                        첫 콘텐츠가 화면에 표시되는 시간. 사용자가 페이지 로딩을 체감하는 첫 순간입니다. (좋음: 1.8초 이하)
                      </span>
                    </span>
                  </th>
                  <th style="width: 70px;">
                    <span class="tooltip-header">
                      LCP
                      <span class="tooltip-text">
                        <strong>Largest Contentful Paint</strong>
                        가장 큰 콘텐츠가 화면에 표시되는 시간. 페이지의 주요 콘텐츠 로딩 속도를 나타냅니다. (좋음: 2.5초 이하)
                      </span>
                    </span>
                  </th>
                  <th style="width: 70px;">
                    <span class="tooltip-header">
                      TBT
                      <span class="tooltip-text">
                        <strong>Total Blocking Time</strong>
                        메인 스레드가 차단된 총 시간(ms). JavaScript 실행으로 인한 페이지 반응 지연을 측정합니다. (좋음: 200ms 이하)
                      </span>
                    </span>
                  </th>
                  <th style="width: 90px;">상세보기</th>
                  <th style="width: 70px;">측정횟수</th>
                </tr>
              </thead>
              <tbody id="resultsTableBody">
                <tr>
                  <td colspan="11" style="text-align:center;">
                    데이터를 불러오는 중...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="pagination" id="pagination"></div>
        </section>
      </div>

      <!-- ==================== URL 관리 탭 ==================== -->
      <div id="tab-urlmanager" class="tab-content">
        <!-- 엑셀 복붙 영역 -->
        <section class="paste-section">
          <h2>📝 엑셀에서 복사-붙여넣기</h2>
          <p class="help-text">
            엑셀에서 URL, 사이트명, 페이지상세, 네트워크 열을 복사해서 아래에 붙여넣으세요.
          </p>

          <textarea
            id="pasteArea"
            placeholder="엑셀에서 복사한 내용을 여기에 붙여넣으세요 (Ctrl+V)&#10;&#10;예시:&#10;https://example.com	사이트A	메인페이지	Mobile&#10;https://example.com	사이트A	메인페이지	Desktop"
            rows="8"
          ></textarea>

          <div class="button-group">
            <button onclick="parseExcelData()" class="btn btn-primary">
              ✅ 데이터 검증
            </button>
            <button onclick="clearPasteArea()" class="btn btn-secondary">
              🗑️ 지우기
            </button>
          </div>

          <!-- 검증 결과 -->
          <div id="validationResult" class="validation-result" style="display:none;">
            <h3>검증 결과</h3>
            <div id="validationSummary"></div>
            <div id="validationDetails"></div>
            <button onclick="saveUrls()" class="btn btn-success">
              💾 저장하기
            </button>
          </div>
        </section>

        <!-- 현재 등록된 URL 목록 -->
        <section class="url-list-section">
          <div class="section-header">
            <h2>📋 등록된 URL (<span id="urlCount">0</span>개)</h2>
            <div class="button-group">
              <button onclick="loadUrls()" class="btn btn-secondary">
                🔄 새로고침
              </button>
              <button onclick="deleteAllUrls()" class="btn btn-danger">
                🗑️ 전체 삭제
              </button>
            </div>
          </div>

          <div class="search-bar">
            <input
              type="text"
              id="searchInput"
              placeholder="URL 또는 사이트명 검색..."
              onkeyup="filterUrlList()"
            >
          </div>

          <div class="table-container">
            <table id="urlTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>URL</th>
                  <th>사이트명</th>
                  <th>페이지상세</th>
                  <th>네트워크</th>
                  <th>등록일</th>
                  <th>작업</th>
                </tr>
              </thead>
              <tbody id="urlTableBody">
                <tr>
                  <td colspan="7" style="text-align:center;">
                    데이터를 불러오는 중...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
      </div>
    </main>

    <!-- 로딩 모달 -->
    <div id="loadingModal" class="modal">
      <div class="modal-content">
        <div class="loading-animation">
          <div class="spinner"></div>
        </div>
        <h3 id="loadingTitle">⏳ 성능 측정 중...</h3>
        <p id="loadingMessage">측정이 진행 중입니다. 잠시만 기다려주세요.</p>
        <div class="progress-container">
          <div class="progress-bar-loading">
            <div id="loadingProgressBar" class="progress-fill"></div>
          </div>
          <div class="progress-text">
            <span id="loadingProgress">0</span> / <span id="loadingTotal">0</span> 완료
          </div>
        </div>
        <div class="loading-details">
          <p id="currentUrl">-</p>
        </div>
      </div>
    </div>

    <!-- 측정 상세보기 모달 -->
    <div id="detailModal" class="modal">
      <div class="modal-content detail-modal-large">
        <div class="modal-header">
          <h2 id="detailTitle">📊 측정 이력</h2>
          <button onclick="closeDetailModal()" class="close-btn">✕</button>
        </div>

        <div class="modal-body">
          <!-- 기본 정보 (평균 포함) -->
          <section class="detail-section">
            <h3>📌 기본 정보</h3>
            <div class="info-cards">
              <div class="info-card">
                <span class="info-label">사이트명</span>
                <span class="info-value" id="detail-site-name">-</span>
              </div>
              <div class="info-card">
                <span class="info-label">페이지상세</span>
                <span class="info-value" id="detail-page-detail">-</span>
              </div>
              <div class="info-card">
                <span class="info-label">네트워크</span>
                <span class="info-value" id="detail-network">-</span>
              </div>
              <div class="info-card">
                <span class="info-label">URL</span>
                <span class="info-value" id="detail-url-display">-</span>
              </div>
            </div>

            <!-- 평균값 추가 -->
            <div class="average-metrics">
              <h4>📊 Performance 평균점수</h4>
              <div class="avg-grid">
                <div class="avg-item">
                  <span class="avg-label">Performance</span>
                  <span class="avg-value" id="detail-avg-perf">-</span>
                </div>
                <div class="avg-item">
                  <span class="avg-label">FCP</span>
                  <span class="avg-value" id="detail-avg-fcp">-</span>
                </div>
                <div class="avg-item">
                  <span class="avg-label">LCP</span>
                  <span class="avg-value" id="detail-avg-lcp">-</span>
                </div>
                <div class="avg-item">
                  <span class="avg-label">TBT</span>
                  <span class="avg-value" id="detail-avg-tbt">-</span>
                </div>
              </div>
            </div>
          </section>

          <!-- 성능 추이 그래프 (180일, TBT 제외) -->
          <section class="detail-section">
            <h3>📈 Performance 평균 추이 (최근 180일)</h3>
            <div class="chart-container-detail">
              <canvas id="detailChart"></canvas>
            </div>
          </section>

          <!-- 측정 이력 테이블 -->
          <section class="detail-section">
            <h3>📋 측정 이력 (최신순)</h3>
            <div class="table-container">
              <table class="history-table">
                <thead>
                  <tr>
                    <th>번호</th>
                    <th>측정일시</th>
                    <th>
                      <span class="tooltip-header">
                        Performance
                        <span class="tooltip-text">
                          <strong>Performance Score</strong>
                          Google Lighthouse 성능 점수 (0-100점). 페이지 로딩 속도와 사용자 경험을 종합 평가합니다.
                        </span>
                      </span>
                    </th>
                    <th>
                      <span class="tooltip-header">
                        상태
                        <span class="tooltip-text">
                          <strong>Performance Status</strong>
                          Good (90-100점): 우수<br>
                          Needs Improvement (50-89점): 개선 필요<br>
                          Poor (0-49점): 나쁨
                        </span>
                      </span>
                    </th>
                    <th>
                      <span class="tooltip-header">
                        FCP
                        <span class="tooltip-text">
                          <strong>First Contentful Paint</strong>
                          첫 콘텐츠가 화면에 표시되는 시간. 사용자가 페이지 로딩을 체감하는 첫 순간입니다. (좋음: 1.8초 이하)
                        </span>
                      </span>
                    </th>
                    <th>
                      <span class="tooltip-header">
                        LCP
                        <span class="tooltip-text">
                          <strong>Largest Contentful Paint</strong>
                          가장 큰 콘텐츠가 화면에 표시되는 시간. 페이지의 주요 콘텐츠 로딩 속도를 나타냅니다. (좋음: 2.5초 이하)
                        </span>
                      </span>
                    </th>
                    <th>
                      <span class="tooltip-header">
                        TBT
                        <span class="tooltip-text">
                          <strong>Total Blocking Time</strong>
                          메인 스레드가 차단된 총 시간(ms). JavaScript 실행으로 인한 페이지 반응 지연을 측정합니다. (좋음: 200ms 이하)
                        </span>
                      </span>
                    </th>
                    <th>
                      <span class="tooltip-header">
                        Speed Index
                        <span class="tooltip-text">
                          <strong>Speed Index</strong>
                          페이지 콘텐츠가 얼마나 빨리 시각적으로 표시되는지 측정합니다. 낮을수록 좋습니다. (좋음: 3.4초 이하)
                        </span>
                      </span>
                    </th>
                  </tr>
                </thead>
                <tbody id="historyTableBody">
                  <tr>
                    <td colspan="8" style="text-align:center;">
                      데이터를 불러오는 중...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- 최신 측정 상세 정보 -->
          <section class="detail-section">
            <h3>💡 최신 측정 분석</h3>
            <div class="analysis-grid">
              <div class="analysis-box">
                <h4>⚠️ 주요 문제점</h4>
                <div id="detail-issues">
                  <p class="text-muted">데이터 없음</p>
                </div>
              </div>
              <div class="analysis-box">
                <h4>💡 개선 제안</h4>
                <div id="detail-suggestions">
                  <p class="text-muted">데이터 없음</p>
                </div>
              </div>
            </div>
          </section>
        </div>

        <div class="modal-footer">
          <button onclick="closeDetailModal()" class="btn btn-secondary">
            닫기
          </button>
          <a id="detail-view-url" href="#" target="_blank" class="btn btn-primary">
            🔗 URL 열기
          </a>
        </div>
      </div>
    </div>

    <!-- 5G 예상값 설명 모달 -->
    <div id="explanation5GModal" class="modal">
      <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
          <h2>📱 5G 예상값 계산 방법</h2>
          <button onclick="close5GExplanationModal()" class="close-btn">✕</button>
        </div>

        <div class="modal-body" style="padding: 25px; max-height: 70vh; overflow-y: auto; text-align: left;">
          <!-- 개요 -->
          <section style="margin-bottom: 25px; text-align: left;">
            <h3 style="color: #667eea; margin-bottom: 12px; text-align: center;">📊 개요</h3>
            <p style="line-height: 1.7; color: #555; text-align: left;">
              5G 예상값은 <strong>Slow 4G 환경에서 측정된 실제 데이터</strong>를 기반으로,
              5G 네트워크 환경에서의 성능을 <strong>보수적으로 추정</strong>한 값입니다.
            </p>
          </section>

          <!-- 네트워크 조건 비교 -->
          <section style="margin-bottom: 25px; text-align: left;">
            <h3 style="color: #667eea; margin-bottom: 12px; text-align: center;">🌐 네트워크 조건</h3>
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: #f8f9fa;">
                  <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">환경</th>
                  <th style="padding: 10px; border: 1px solid #ddd; text-align: right;">다운로드 속도</th>
                  <th style="padding: 10px; border: 1px solid #ddd; text-align: right;">속도 차이</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding: 10px; border: 1px solid #ddd;"><strong>Slow 4G</strong> (측정)</td>
                  <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">400 Kbps</td>
                  <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">-</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #ddd;"><strong>5G</strong> (예상)</td>
                  <td style="padding: 10px; border: 1px solid #ddd; text-align: right;">~150 Mbps</td>
                  <td style="padding: 10px; border: 1px solid #ddd; text-align: right; color: #28a745;"><strong>약 375배 빠름</strong></td>
                </tr>
              </tbody>
            </table>
          </section>

          <!-- 변환 계산식 -->
          <section style="margin-bottom: 25px; text-align: left;">
            <h3 style="color: #667eea; margin-bottom: 12px; text-align: center;">🧮 변환 계산식</h3>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
              <div style="margin-bottom: 12px;">
                <strong style="color: #667eea;">📉 네트워크 영향 메트릭 (개선됨)</strong>
                <ul style="margin: 8px 0; padding-left: 20px; line-height: 1.8;">
                  <li><strong>FCP</strong> (First Contentful Paint): <code>측정값 × 0.3</code> → <strong>70% 감소</strong></li>
                  <li><strong>LCP</strong> (Largest Contentful Paint): <code>측정값 × 0.3</code> → <strong>70% 감소</strong></li>
                  <li><strong>Speed Index</strong>: <code>측정값 × 0.4</code> → <strong>60% 감소</strong></li>
                </ul>
              </div>
              <div>
                <strong style="color: #667eea;">⚡ CPU 영향 메트릭 (변화 없음)</strong>
                <ul style="margin: 8px 0; padding-left: 20px; line-height: 1.8;">
                  <li><strong>TBT</strong> (Total Blocking Time): <code>측정값 그대로</code></li>
                  <li><strong>CLS</strong> (Cumulative Layout Shift): <code>측정값 그대로</code></li>
                </ul>
              </div>
            </div>
          </section>

          <!-- Performance 점수 재계산 -->
          <section style="margin-bottom: 25px; text-align: left;">
            <h3 style="color: #667eea; margin-bottom: 12px; text-align: center;">🎯 Performance 점수 재계산</h3>
            <p style="line-height: 1.7; color: #555; margin-bottom: 12px; text-align: left;">
              메트릭 개선에 따라 Performance 점수도 상승합니다.
              현재 점수가 낮을수록 개선 효과가 크게 나타납니다.
            </p>
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: #f8f9fa;">
                  <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">현재 점수 범위</th>
                  <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">개선 정도</th>
                  <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">예시</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding: 10px; border: 1px solid #ddd;"><strong>Poor</strong> (0-49점)</td>
                  <td style="padding: 10px; border: 1px solid #ddd;">최대 2.26배</td>
                  <td style="padding: 10px; border: 1px solid #ddd;">28점 → 50-63점</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #ddd;"><strong>Needs Improvement</strong> (50-89점)</td>
                  <td style="padding: 10px; border: 1px solid #ddd;">최대 1.81배</td>
                  <td style="padding: 10px; border: 1px solid #ddd;">50점 → 75-90점</td>
                </tr>
                <tr>
                  <td style="padding: 10px; border: 1px solid #ddd;"><strong>Good</strong> (90-100점)</td>
                  <td style="padding: 10px; border: 1px solid #ddd;">최대 1.32배</td>
                  <td style="padding: 10px; border: 1px solid #ddd;">92점 → 96-100점</td>
                </tr>
              </tbody>
            </table>
          </section>

          <!-- 주의사항 -->
          <section style="text-align: left;">
            <h3 style="color: #e74c3c; margin-bottom: 12px; text-align: center;">⚠️ 주의사항</h3>
            <ul style="margin: 0; padding-left: 20px; line-height: 1.8; color: #555; text-align: left;">
              <li>이 값은 <strong>보수적 추정치</strong>로, 실제 5G 환경에서는 더 나은 성능이 나올 수 있습니다.</li>
              <li>네트워크 속도와 무관한 요소(JavaScript 실행, 레이아웃 시프트 등)는 개선되지 않습니다.</li>
              <li>실제 성능은 사용자 기기, 서버 응답 시간, 캐싱 등 다양한 요인에 영향을 받습니다.</li>
              <li>참고용 지표로만 활용하시고, 정확한 측정이 필요한 경우 실제 5G 환경에서 테스트하시기 바랍니다.</li>
            </ul>
          </section>
        </div>

        <div class="modal-footer">
          <button onclick="close5GExplanationModal()" class="btn btn-primary">
            확인
          </button>
        </div>
      </div>
    </div>

  </div>

    <!-- 접속 기록 모달 -->
    <div id="loginHistoryModal" class="modal">
      <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
          <h2>📋 접속 기록</h2>
          <button onclick="closeLoginHistoryModal()" class="close-btn">✕</button>
        </div>
        <div class="modal-body" style="padding: 20px; max-height: 500px; overflow-y: auto;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: #f8f9fa;">
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">이메일</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">접속 시간</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">IP</th>
              </tr>
            </thead>
            <tbody id="loginHistoryBody">
              <tr>
                <td colspan="3" style="padding: 20px; text-align: center;">로딩 중...</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button onclick="closeLoginHistoryModal()" class="btn btn-secondary">닫기</button>
        </div>
      </div>
    </div>

    <!-- 개선사항 Report 모달 -->
    <div id="improvementReportModal" class="modal">
      <div class="modal-content improvement-report-modal">
        <div class="modal-header">
          <h2>📋 개선사항 Report</h2>
          <span class="report-date-range" id="reportDateRange"></span>
          <button onclick="closeImprovementReportModal()" class="close-btn">✕</button>
        </div>
        <div class="modal-body" id="improvementReportBody">
          <div class="report-loading">
            <div class="spinner"></div>
            <p>개선사항을 분석하고 있습니다...</p>
          </div>
        </div>
        <div class="modal-footer">
          <button onclick="closeImprovementReportModal()" class="btn btn-secondary">닫기</button>
        </div>
      </div>
    </div>

    <!-- 이전 답변 모아보기 모달 -->
    <div id="suggestionHistoryModal" class="modal">
      <div class="modal-content suggestion-history-modal">
        <div class="modal-header">
          <h2>📚 이전 답변 모아보기</h2>
          <button onclick="closeSuggestionHistoryModal()" class="close-btn">✕</button>
        </div>
        <div class="modal-subheader">
          <span id="historyIssueTitle" class="history-issue-title"></span>
        </div>
        <div class="modal-body" id="suggestionHistoryBody">
          <div class="report-loading">
            <div class="spinner"></div>
            <p>이전 답변을 불러오는 중...</p>
          </div>
        </div>
        <div class="modal-footer">
          <button onclick="closeSuggestionHistoryModal()" class="btn btn-secondary">닫기</button>
        </div>
      </div>
    </div>

  <script src="js/dashboard.js"></script>
  <script src="js/url-manager.js"></script>
</body>
</html>
